define(["./day-of-week","./day-of-year","./milliseconds-in-day","./pattern-re","./start-of","./timezone-hour-format","./week-days","../util/remove-literal-quotes"],function(dateDayOfWeek,dateDayOfYear,dateMillisecondsInDay,datePatternRe,dateStartOf,dateTimezoneHourFormat,dateWeekDays,removeLiteralQuotes){return function(date,numberFormatters,properties){var timeSeparator=properties.timeSeparator;return properties.pattern.replace(datePatternRe,function(current){var ret,chr=current.charAt(0),length=current.length;if(chr==="j"){chr=properties.preferredTime}if(chr==="Z"){if(length<4){chr="x";length=4}else if(length<5){chr="O";length=4}else{chr="X";length=5}}switch(chr){case"G":ret=properties.eras[date.getFullYear()<0?0:1];break;case"y":ret=date.getFullYear();if(length===2){ret=String(ret);ret=+ret.substr(ret.length-2)}break;case"Y":ret=new Date(date.getTime());ret.setDate(ret.getDate()+7-dateDayOfWeek(date,properties.firstDay)-properties.firstDay-properties.minDays);ret=ret.getFullYear();if(length===2){ret=String(ret);ret=+ret.substr(ret.length-2)}break;case"Q":case"q":ret=Math.ceil((date.getMonth()+1)/3);if(length>2){ret=properties.quarters[chr][length][ret]}break;case"M":case"L":ret=date.getMonth()+1;if(length>2){ret=properties.months[chr][length][ret]}break;case"w":ret=dateDayOfWeek(dateStartOf(date,"year"),properties.firstDay);ret=Math.ceil((dateDayOfYear(date)+ret)/7)-(7-ret>=properties.minDays?0:1);break;case"W":ret=dateDayOfWeek(dateStartOf(date,"month"),properties.firstDay);ret=Math.ceil((date.getDate()+ret)/7)-(7-ret>=properties.minDays?0:1);break;case"d":ret=date.getDate();break;case"D":ret=dateDayOfYear(date)+1;break;case"F":ret=Math.floor(date.getDate()/7)+1;break;case"e":case"c":if(length<=2){ret=dateDayOfWeek(date,properties.firstDay)+1;break}case"E":ret=dateWeekDays[date.getDay()];ret=properties.days[chr][length][ret];break;case"a":ret=properties.dayPeriods[date.getHours()<12?"am":"pm"];break;case"h":ret=date.getHours()%12||12;break;case"H":ret=date.getHours();break;case"K":ret=date.getHours()%12;break;case"k":ret=date.getHours()||24;break;case"m":ret=date.getMinutes();break;case"s":ret=date.getSeconds();break;case"S":ret=Math.round(date.getMilliseconds()*Math.pow(10,length-3));break;case"A":ret=Math.round(dateMillisecondsInDay(date)*Math.pow(10,length-3));break;case"z":case"O":if(date.getTimezoneOffset()===0){ret=properties.gmtZeroFormat}else{ret=dateTimezoneHourFormat(date,length<4?"+H;-H":properties.tzLongHourFormat,timeSeparator,numberFormatters);ret=properties.gmtFormat.replace(/\{0\}/,ret)}break;case"X":if(date.getTimezoneOffset()===0){ret="Z";break}case"x":ret=length===1?"+HH;-HH":length%2?"+HH:mm;-HH:mm":"+HHmm;-HHmm";ret=dateTimezoneHourFormat(date,ret,":");break;case":":ret=timeSeparator;break;case"'":ret=removeLiteralQuotes(current);break;default:ret=current}if(typeof ret==="number"){ret=numberFormatters[length](ret)}return ret})}});